---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
-----------------------------------------------------------------------------------------------------------------------------
-- Creation of csw_FetchDesignElement									      
-----------------------------------------------------------------------------------------------------------------------------
If exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[csw_FetchDesignElement]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
Begin
	Print '**** Drop Stored Procedure dbo.csw_FetchDesignElement.'
	Drop procedure [dbo].[csw_FetchDesignElement]
End
Print '**** Creating Stored Procedure dbo.csw_FetchDesignElement...'
Print ''
GO

SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO


CREATE PROCEDURE dbo.csw_FetchDesignElement
(
	@pnUserIdentityId	int,		-- Mandatory
	@psCulture		nvarchar(10) 	= null,
	@pbCalledFromCentura	bit		= 0,
	@pnCaseKey		int -- Mandatory
)
as
-- PROCEDURE:	csw_FetchDesignElement
-- VERSION:	2
-- COPYRIGHT:	Copyright CPA Software Solutions (Australia) Pty Limited
-- DESCRIPTION:	Populate the DesignElement business entity.

-- MODIFICATIONS :
-- Date		Who	Change	Version	Description
-- -----------	-------	-------	-------	-----------------------------------------------
-- 13 Jul 2006	LP	RFC4143	1	Procedure created
-- 24 Oct 2011	ASH	R11460  2	Cast integer columns as nvarchar(11) data type.

SET NOCOUNT ON
SET CONCAT_NULL_YIELDS_NULL OFF

Declare @nErrorCode	int
Declare @sSQLString 	nvarchar(4000)

-- Initialise variables
Set @nErrorCode = 0

If @nErrorCode = 0
Begin
	Set @sSQLString = "Select

	CAST(D.CASEID as nvarchar(11))+'^'+CAST(D.SEQUENCE as nvarchar(10))		as RowKey,
	D.CASEID		as CaseKey,
	D.SEQUENCE		as Sequence,
	D.FIRMELEMENTID		as FirmElementID,
	D.ELEMENTDESC		as Description,
	D.CLIENTELEMENTID		as ClientElementReference,
	D.RENEWFLAG		as ToRenew,
	D.TYPEFACE		as Typeface,
	D.OFFICIALELEMENTID		as OfficialElementID,
	D.REGISTRATIONNO		as RegistrationNumber
	from DESIGNELEMENT D
	where 
	D.CASEID = @pnCaseKey
	order by CaseKey, Sequence, FirmElementID"

	exec @nErrorCode=sp_executesql @sSQLString,
			N'
			@pnCaseKey		int',
			@pnCaseKey	 = @pnCaseKey
End

Return @nErrorCode
GO

Grant execute on dbo.csw_FetchDesignElement to public
GO